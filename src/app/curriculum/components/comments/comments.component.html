<div class="container-fluid p-3">
  <h2 class="comments d-flex align-items-center my-2">
    <span class="me-1">Comments</span>
    <mat-icon class="mt-1">chat</mat-icon>
  </h2>
  <div class="my-2">
    <div
      [ngStyle]="{
        'max-height': height + 'px',
        'background-color': insideColor
      }"
      style="overflow-y: scroll; overflow-x: hidden"
    >
      <mat-card class="shadow p-4" *ngIf="comments.length == 0">
        <mat-card-content class="text-center">
          <div>
            <mat-icon>announcement</mat-icon>
          </div>
          this curriculum doesn't have comments
        </mat-card-content>
      </mat-card>
      <mat-card
        class="comment-card mb-3 m-1"
        *ngFor="let comment of comments"
        [ngStyle]="{ 'background-color': commentColor }"
      >
        <mat-card-header class="">
          <img
            mat-card-avatar
            src="{{
              'https://www.slarenasitsolutions.com/4iadonis/public_html/index.php/api/profiles/images/' +
                (comment?.user?.profile?.profile_pic || 'no-image.jpg')
            }}"
            class="border"
          />

          <mat-card-subtitle class="flex-grow-1">
            <span>{{
              comment.user?.profile?.name || "not set his/her name yet"
            }}</span>
            <div>
              <small class="">{{
                comment.created_at | timeDifferencePipe
              }}</small>
            </div>
          </mat-card-subtitle>
          <div
            class="position-absolute top-0 end-0 pt-3 pe-3"
            *ngIf="userId == comment.user_id"
          >
            <mat-icon (click)="deleteComment(comment.id)">delete</mat-icon>
            <mat-icon (click)="clickEditComment(comment.id)">edit</mat-icon>
          </div>
        </mat-card-header>
        <mat-card-content class="mt-2">
          <p *ngIf="!isShowForm(comment.id)">{{ comment.body }}</p>
          <form
            action=""
            *ngIf="isShowForm(comment.id)"
            #commentForm="ngForm"
            (ngSubmit)="editComment(comment.id, commentForm)"
          >
            <textarea
              name="body"
              id=""
              cols="29"
              rows="3"
              [ngModel]="comment.body"
              >{{ comment.body }}</textarea
            >
            <button type="submit" mat-flat-button color="primary" class="me-2">
              Confirm
            </button>
            <button
              type="button"
              mat-flat-button
              color="primary"
              (click)="clickCancelComment(comment.id)"
            >
              Cancel
            </button>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
    <form
      class="w-100 p-2 shadow-sm"
      *ngIf="type == 'view' && role == 'reviewer'"
      #commentForm="ngForm"
      (ngSubmit)="submit(commentForm)"
    >
      <mat-form-field class="example-full-width w-100">
        <mat-label>Leave a comment</mat-label>
        <textarea
          type="text"
          name="body"
          style="resize: none; height: 80px"
          matInput
          placeholder="Ex. It makes me feel..."
          [(ngModel)]="comment.body"
        ></textarea>
      </mat-form-field>
      <button mat-flat-button color="primary" class="">
        <mat-icon>send</mat-icon>
      </button>
    </form>
  </div>
  <!-- <form
    class="example-form"
    #commentForm="ngForm"
    (ngSubmit)="addComment(commentForm)"
  >
    <mat-form-field class="example-full-width">
      <mat-label>Subject</mat-label>
      <input
        matInput
        placeholder=""
        type="text"
        name="header"
        value="Header"
        ngModel
      />
    </mat-form-field>

    <mat-form-field class="example-full-width">
      <mat-label>Leave a comment</mat-label>
      <textarea
        type="text"
        name="feedback"
        style="resize: none; height: 80px"
        matInput
        placeholder="Ex. It makes me feel..."
        ngModel
      ></textarea>
      <button
        mat-raised-button
        color="primary"
        style="float: right; width: 1px"
        type="submit"
      >
        <mat-icon>send</mat-icon>
      </button>
    </mat-form-field>
  </form> -->
</div>
